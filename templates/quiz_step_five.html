{% extends "base.html" %}
{% load i18n %}
{% load static %}

{% block content %}
    <div id="main" role="main">
        <div class="quiz-header px-4 py-0">
            <div class="d-flex align-items-center">
                <div class="quiz-logo-box">
                    <a href="#">
                        <img class="logo-quiz" src="{% static 'assets/img/premium.png' %}" alt="">
                    </a>
                </div>
                <div class="quiz-nav-box">
                    <nav class="quiz-header-links" role="navigation">
                        <div class="sm-only text-center">
                            <a class="active" href="/quiz/step_three" aria-current="page" disabled="">Step(5/5)</a>
                        </div>
                        <div class="lg-only">
                            <a class="" href="/quiz/step_one" aria-current="page" disabled="">Step1</a>
                            <a class="" disabled="" href="/quiz/step_two">Step2</a>
                            <a class="" disabled="" href="/quiz/step_three">Step3</a>
                            <a class="" disabled="" href="/quiz/step_four">Step4</a>
                            <a class="active" disabled="" href="/quiz/step_five">Step5</a>
                        </div>
                        <div class="header-progress-box lg-only">
                            <div class="HeaderProgress">
                                <div class="HeaderProgress-bar inactive"></div>
                                <div class="HeaderProgress-bar active w-100"></div>
                                <div class="HeaderProgress-steps">
                                    <span class="active"></span>
                                    <span class="active"></span>
                                    <span class="active"></span>
                                    <span class="active"></span>
                                    <span class="active"></span>
                                </div>
                            </div>
                        </div>
                    </nav>
                </div>
                <div class="quiz-special-box">
                    <div class="DiscountBadge lg-only">
                        <div class="special-icon-box">
                            <svg fill="#ffffff"width="32" height="32" alt="Present Icon" viewBox="0 0 44 44" version="1.1"><path d="M36.5,20.6093474 L36.5,15.6834215 L7.5,15.6834215 L7.5,20.6093474 L36.5,20.6093474 Z M6.5,14.6834215 L37.5,14.6834215 L37.5,21.6093474 L6.5,21.6093474 L6.5,14.6834215 Z M21.5,21.1093474 L22.5,21.1093474 L22.5,36.9823633 L21.5,36.9823633 L21.5,21.1093474 Z M22.5,21.1093474 L22.5,36.9823633 L21.5,36.9823633 L21.5,21.1093474 L22.5,21.1093474 Z M10.1433895,20.8156966 L11.0155482,32.2021855 C11.1901404,34.6268928 13.2537126,36.5 15.7435233,36.5 L28.2564767,36.5 C30.7462874,36.5 32.8098596,34.6268928 32.9846209,32.1999089 L33.8566103,20.8156966 L10.1433895,20.8156966 Z M34.8949127,20.353883 L33.9818694,32.274005 C33.7692194,35.2272531 31.2653706,37.5 28.2564767,37.5 L15.7435233,37.5 C12.7346294,37.5 10.2307806,35.2272531 10.0182997,32.2762816 L9.06386415,19.8156966 L34.9361358,19.8156966 L34.8949127,20.353883 Z M18.4141656,10.3772967 C16.9995862,8.20947802 15.8271554,7.5 13.6839378,7.5 C11.627303,7.5 10.0259067,9.07629517 10.0259067,11.0917108 C10.0259067,13.1071264 11.627303,14.6834215 13.6839378,14.6834215 L21.1289363,14.6834215 C20.2688634,13.2275126 19.3643489,11.7927229 18.4141656,10.3772967 Z M13.6839378,15.6834215 C11.0785237,15.6834215 9.02590674,13.6629783 9.02590674,11.0917108 C9.02590674,8.52044319 11.0785237,6.5 13.6839378,6.5 C16.1845026,6.5 17.66131,7.39366669 19.2480298,9.8253657 C20.3699027,11.4964694 21.4321127,13.2000327 22.4329989,14.9333976 L22.8660806,15.6834215 L13.6839378,15.6834215 Z M30.1217617,14.6834215 C32.1368375,14.6834215 33.7020725,13.1450424 33.7020725,11.1798942 C33.7020725,9.21474592 32.1368375,7.67636684 30.1217617,7.67636684 C28.032931,7.67636684 26.881606,8.37200448 25.4816546,10.5199076 C25.2561694,10.8052097 24.7428485,11.6049424 24.0473089,12.7418801 C24.0023668,12.8153794 24.0023668,12.8153794 23.9574573,12.8889658 C23.6175698,13.4461441 23.2584061,14.0434716 22.9026908,14.6408473 C22.894164,14.6551669 22.8857149,14.6693591 22.8773447,14.6834215 L30.1217617,14.6834215 Z M30.1217617,15.6834215 L21.1258279,15.6834215 L21.5690238,14.9299269 C21.6633726,14.7695209 21.8290522,14.4893279 22.043483,14.1292206 C22.4008835,13.5290149 22.7618067,12.928761 23.1037597,12.3681968 C23.1489926,12.2940805 23.1489926,12.2940805 23.1942757,12.2200235 C23.9157808,11.0406422 24.4358277,10.2304307 24.6702715,9.93720539 C26.2192557,7.55635325 27.6756898,6.67636684 30.1217617,6.67636684 C32.6852855,6.67636684 34.7020725,8.65855027 34.7020725,11.1798942 C34.7020725,13.7012381 32.6852855,15.6834215 30.1217617,15.6834215 Z"></path></svg>
                        </div>
                        <span style="margin-top: 4px; margin-left: 10px;">
                            <h2 class="Title separe">DRIVE EGET KONTOR?</h2>
                            <p class="Text"><small>Sjekk ut W Flex her</small></p>
                        </span>
                    </div>
                    <div class="DiscountBadge sm-only">
                        <div class="special-icon-box">
                            <svg fill="#ffffff" width="24" height="24" alt="Present Icon" viewBox="0 0 44 44" version="1.1"><path d="M36.5,20.6093474 L36.5,15.6834215 L7.5,15.6834215 L7.5,20.6093474 L36.5,20.6093474 Z M6.5,14.6834215 L37.5,14.6834215 L37.5,21.6093474 L6.5,21.6093474 L6.5,14.6834215 Z M21.5,21.1093474 L22.5,21.1093474 L22.5,36.9823633 L21.5,36.9823633 L21.5,21.1093474 Z M22.5,21.1093474 L22.5,36.9823633 L21.5,36.9823633 L21.5,21.1093474 L22.5,21.1093474 Z M10.1433895,20.8156966 L11.0155482,32.2021855 C11.1901404,34.6268928 13.2537126,36.5 15.7435233,36.5 L28.2564767,36.5 C30.7462874,36.5 32.8098596,34.6268928 32.9846209,32.1999089 L33.8566103,20.8156966 L10.1433895,20.8156966 Z M34.8949127,20.353883 L33.9818694,32.274005 C33.7692194,35.2272531 31.2653706,37.5 28.2564767,37.5 L15.7435233,37.5 C12.7346294,37.5 10.2307806,35.2272531 10.0182997,32.2762816 L9.06386415,19.8156966 L34.9361358,19.8156966 L34.8949127,20.353883 Z M18.4141656,10.3772967 C16.9995862,8.20947802 15.8271554,7.5 13.6839378,7.5 C11.627303,7.5 10.0259067,9.07629517 10.0259067,11.0917108 C10.0259067,13.1071264 11.627303,14.6834215 13.6839378,14.6834215 L21.1289363,14.6834215 C20.2688634,13.2275126 19.3643489,11.7927229 18.4141656,10.3772967 Z M13.6839378,15.6834215 C11.0785237,15.6834215 9.02590674,13.6629783 9.02590674,11.0917108 C9.02590674,8.52044319 11.0785237,6.5 13.6839378,6.5 C16.1845026,6.5 17.66131,7.39366669 19.2480298,9.8253657 C20.3699027,11.4964694 21.4321127,13.2000327 22.4329989,14.9333976 L22.8660806,15.6834215 L13.6839378,15.6834215 Z M30.1217617,14.6834215 C32.1368375,14.6834215 33.7020725,13.1450424 33.7020725,11.1798942 C33.7020725,9.21474592 32.1368375,7.67636684 30.1217617,7.67636684 C28.032931,7.67636684 26.881606,8.37200448 25.4816546,10.5199076 C25.2561694,10.8052097 24.7428485,11.6049424 24.0473089,12.7418801 C24.0023668,12.8153794 24.0023668,12.8153794 23.9574573,12.8889658 C23.6175698,13.4461441 23.2584061,14.0434716 22.9026908,14.6408473 C22.894164,14.6551669 22.8857149,14.6693591 22.8773447,14.6834215 L30.1217617,14.6834215 Z M30.1217617,15.6834215 L21.1258279,15.6834215 L21.5690238,14.9299269 C21.6633726,14.7695209 21.8290522,14.4893279 22.043483,14.1292206 C22.4008835,13.5290149 22.7618067,12.928761 23.1037597,12.3681968 C23.1489926,12.2940805 23.1489926,12.2940805 23.1942757,12.2200235 C23.9157808,11.0406422 24.4358277,10.2304307 24.6702715,9.93720539 C26.2192557,7.55635325 27.6756898,6.67636684 30.1217617,6.67636684 C32.6852855,6.67636684 34.7020725,8.65855027 34.7020725,11.1798942 C34.7020725,13.7012381 32.6852855,15.6834215 30.1217617,15.6834215 Z"></path></svg>
                        </div>
                        <p class="Text" style="text-transform: uppercase; color: rgb(21, 58, 51); font-weight: 700; margin-top: 8px; font-size: 12px;">W Flex</p>
                    </div>
                </div>
                <div class="HeaderProgress sm-only">
                    <div class="HeaderProgress-bar inactive"></div>
                    <div class="HeaderProgress-bar active w-100"></div>
                    <div class="HeaderProgress-steps">
                        <span class="active"></span>
                        <span class="active"></span>
                        <span class="active"></span>
                        <span class="active"></span>
                        <span class="active"></span>
                    </div>
                </div>
            </div>
        </div>
        <div class="quiz-content">
            <h2 class="main-caption">En ny og bedre meglerhverdag starter her</h2>
            <p class="sub-caption">La oss finne et lønnsestimat og hvordan din hverdag kan bli hos W Eiendomsmegling.</p>
            <div class="quiz-answer">
                <div class="quiz-form-row text-left">
                    <p>Takk for dine svar.</p>
                    <p>Som en megler hos W vil du ha en brutto lønn på kr <span class="calculation1"></span> og <span class="calculation2"></span> i kjøregodtgjørelser.</p>
                    <p>Totalt: <span class="calculation3"></span></p>
                    <p>Men penger er ikke alt. Du må også ha en arbeidsplass hvor du trives og som tilrettelegger for dine behov.</p>
                </div>
                <div class="quiz-form-row text-left">
                    <p>Chapter A:</p>
                    <p class="chapter-a"></p>
                    <p>Chapter B:</p>
                    <p class="chapter-b"></p>
                    <p>Chapter C:</p>
                    <p>I tillegg kommer en mangde andre grunner som trolig vil gjøre at du kunne trivdes godt hos W Eiendomsmegling.
                        Dersom du har lyst til å lære mer om mulighetene og avklare om vi er en god match.
                        Så er vi alltid åpne for en uforpklitende og konfidensiell prat.
                    </p>
                </div>
                <div class="quiz-form-row text-left">
                    <p>
                        Du kan bruke skjemaet ved å trykke på knappen nedenfor så tar vi kontakt med deg,
                        eller du kan sende oss en epost til <b>stian@wmegling.no</b>.
                    </p>
                    <p>no eller ringe oss på <b>91 90 93 15</b>.</p>
                </div>
            </div>
            <a href="#" class="btn1" id="nextBtn" data-toggle="modal" data-target="#SeligBolig">Bli kontaktet</a>
        </div>
        <div class="modal hide fade" id="SeligBolig" style="display: none;" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="loading-icon-box">
                        <img src="{% static 'assets/img/ajax-loader.gif' %}" class="loading-icon">
                    </div>
                    <div class="enquiryPopup">
                        <div class="modal-header border-0">
                            <h4 class="modal-title w-100" id="selge_modal_title">
                                <div class="popLogo"><img src="{% static 'assets/img/logo2.png' %}"></div>
                                <div class="after-sending d-none">
                                    Takk for din henvendelse.
                                    <p>En W kunderådgiver vil ta kontakt med deg snarest.</p>
                                </div>
                            </h4>
                            <button type="button" class="close" data-dismiss="modal"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">×</font></font></button>
                        </div>
                        <div class="modal-body" id="selge_form_body">
                            <div class="before-sending">
                                <div class="btn-danger text-center">
                                    <span id="empty_field_error_message">Du må oppgi e-post eller telefonnummer for at vi skal kunne kontakte deg.</span>
                                    <span id="email_error_message">E-postadressen er ugyldig.</span>
                                    <span id="agreement_error_message">Du må godta brukeravtale.</span>
                                </div>
                                <form id="contact_form" class="contact_form" enctype="multipart/form-data" novalidate
                                      onsubmit="event.preventDefault();">
                                    {% csrf_token %}
                                    <input type="hidden" name="main_data" id="main_data">

                                    <div class="formPoup din-box">
                                        <div class="popupRow">
                                            <input type="text" name="name" id="name" placeholder="Navn" required>
                                        </div>
                                        <div class="popupRow">
                                            <input type="text" name="email" id="email" placeholder="Epost" required>
                                        </div>
                                        <div class="popupRow">
                                            <input type="number" name="phone" id="phone" placeholder="Tlf" required>
                                        </div>
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="user_agreement" name="user_agreement" required>
                                            <label class="custom-control-label" for="user_agreement">Accept user agreement</label>
                                        </div>
                                        <div class="popupRow popupMubmit text-center">
                                            <button type="submit" class="btn1 btnPadding contactSubmitButton"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Send</font></font></button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block script %}
    <script type="text/javascript">
        let chapters= [
            {
                'answer': 'a great work environment / good colleagues',
                'chapter': 'Det er viktig med et supert arbeidsmiljø One morning, when Gregor Samsa woke from troubled dreams, he found himself transformed in his bed into a horrible vermin. He lay on his armour-like back, and if he lifted his head a little he could see his brown belly, slightly domed and divided by arches into stiff sections'
            },
            {
                'answer': 'opportunity for personal development',
                'chapter': 'Personlig utvikling happens when One morning, when Gregor Samsa woke from troubled dreams, he found himself transformed in his bed into a horrible vermin. He lay on his armour-like back, and if he lifted his head a little he could see his brown belly, slightly domed and divided by arches into stiff sections.'
            },
            {
                'answer': 'the best technology',
                'chapter': 'Teknologi bedding was hardly able to cover it and seemed ready to slide off any moment. His many legs, pitifully thin compared with the size of the rest of him, waved about helplessly as he looked. "What\'s happened to me?" he thought. It wasn\'t a dream. His room, a proper human room although a little too small, lay peacefully between its four familiar walls.'
            },
            {
                'answer': 'opportunity for partnership',
                'chapter': 'Partnere bedding was hardly able to cover it and seemed ready to slide off any moment. His many legs, pitifully thin compared with the size of the rest of him, waved about helplessly as he looked. "What\'s happened to me?" he thought. It wasn\'t a dream. His room, a proper human room although a little too small, lay peacefully between its four familiar walls.'
            },
            {
                'answer': 'high salary',
                'chapter': 'Lønnen din bedding was hardly able to cover it and seemed ready to slide off any moment. His many legs, pitifully thin compared with the size of the rest of him, waved about helplessly as he looked. "What\'s happened to me?" he thought. It wasn\'t a dream. His room, a proper human room although a little too small, lay peacefully between its four familiar walls.'
            },
            {
                'answer': 'freedom',
                'chapter': 'Frihet bedding was hardly able to cover it and seemed ready to slide off any moment. His many legs, pitifully thin compared with the size of the rest of him, waved about helplessly as he looked. "What\'s happened to me?" he thought. It wasn\'t a dream. His room, a proper human room although a little too small, lay peacefully between its four familiar walls.'
            },
            {
                'answer': 'flexibility',
                'chapter': 'Fleksibilitet og bedding was hardly able to cover it and seemed ready to slide off any moment. His many legs, pitifully thin compared with the size of the rest of him, waved about helplessly as he looked. "What\'s happened to me?" he thought. It wasn\'t a dream. His room, a proper human room although a little too small, lay peacefully between its four familiar walls.'
            },
            {
                'answer': 'to be able to influence the workplace',
                'chapter': 'Arbeidsplassen er  far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.'
            },
            {
                'answer': 'quality',
                'chapter': 'Kvalitet  er ikke til å kimse av she reached the first hills of the Italic Mountains, she had a last view back on the skyline of her hometown Bookmarksgrove, the headline of Alphabet Village and the subline of her own road, the Line Lane. Pityful a rethoric question ran over her cheek, then'
            },
            {
                'answer': 'safety',
                'chapter': 'Trygghet she reached the first hills of the Italic Mountains, she had a last view back on the skyline of her hometown Bookmarksgrove, the headline of Alphabet Village and the subline of her own road, the Line Lane. Pityful a rethoric question ran over her cheek, then.'
            },
            {
                'answer': 'to have back office',
                'chapter': 'Backoffice she reached the first hills of the Italic Mountains, she had a last view back on the skyline of her hometown Bookmarksgrove, the headline of Alphabet Village and the subline of her own road, the Line Lane. Pityful a rethoric question ran over her cheek, then'
            },
            {
                'answer': 'the best toolbox',
                'chapter': 'Verktøykassen she reached the first hills of the Italic Mountains, she had a last view back on the skyline of her hometown Bookmarksgrove, the headline of Alphabet Village and the subline of her own road, the Line Lane. Pityful a rethoric question ran over her cheek, then'
            },
            {
                'answer': 'winning culture',
                'chapter': 'Vinnerkulturen Big Oxmox advised her not to do so, because there were thousands of bad Commas, wild Question Marks and devious Semikoli, but the Little Blind Text didn’t listen. She packed her seven versalia, put her initial into the belt and made herself on the way.'
            },
            {
                'answer': 'good lead approach',
                'chapter': 'Vinnerkulturen Big Oxmox advised her not to do so, because there were thousands of bad Commas, wild Question Marks and devious Semikoli, but the Little Blind Text didn’t listen. She packed her seven versalia, put her initial into the belt and made herself on the way.'
            }
        ]

        $(document).ready(function () {
            loadData()
            initErrorMsg()
            // step2
            const sales = parseInt(localStorage.getItem('sales'))
            const commission = parseInt(localStorage.getItem('commission'))
            // step3
            const distance = parseInt(localStorage.getItem('distance'))
            const dataUsage = parseInt(localStorage.getItem('dataUsage'))
            // step4
            const importantThingOne = localStorage.getItem('importantThingOne')
            const importantThingTwo = localStorage.getItem('importantThingTwo')

            const calculation2 = distance * 3.5
            const calculation2b = getCalculation2bValue(dataUsage)
            const calculation1 = (sales * commission * 0.5) - (calculation2 + calculation2b)
            const calculation3 = calculation1 + calculation2

            $('.calculation1').text(calculation1)
            $('.calculation2').text(calculation2)
            $('.calculation3').text(calculation3)

            const chapterA = getChapterByAnswer(importantThingOne)
            const chapterB = getChapterByAnswer(importantThingTwo)
            $('.chapter-a').text(chapterA)
            $('.chapter-b').text(chapterB)

            $('.contactSubmitButton').click(function () {
                $('#empty_field_error_message').hide()
                let email = $('#email').val()
                let phone = $('#phone').val()
                let user_agreement = $('#user_agreement').prop("checked")

                initErrorMsg()
                if (email === '' && phone === '') {
                    $('#empty_field_error_message').show()
                    return
                } else {
                    if (email !=='' && !validateEmail(email)) {
                        $('#email_error_message').show()
                        return
                    }
                }
                if (!user_agreement) {
                    $('#agreement_error_message').show()
                    return
                }

                console.log('111')
                let data = $('#contact_form').serialize();

                $('.loading-icon-box').css('display', 'block')
                $('.contactSubmitButton').attr('disabled', true)

                $.ajax({
                    url: '/quiz/api/send',
                    type: 'POST',
                    data: data
                }).success(function (data) {
                    $(".loading-icon-box").css("display", "none")
                    $('.contactSubmitButton').attr('disabled', false)

                    if (data === 'success') {
                        $('.modal-body').hide()
                        $('.after-sending').removeClass('d-none')
                    } else {
                        alert('Feil !!!');
                    }
                }).error(function (data) {
                    $(".loading-icon-box").css("display", "none")
                    console.info(data)
                })
            })
        });

        const loadData = () => {
            const job = localStorage.getItem('job')
            const address = localStorage.getItem('address')
            const experience = localStorage.getItem('experience')
            const sales = localStorage.getItem('sales')
            const commission = localStorage.getItem('commission')

            const importantThingOne = localStorage.getItem('importantThingOne')
            const importantThingTwo = localStorage.getItem('importantThingTwo')

            const additionalData = {
                job,
                address,
                experience,
                sales,
                commission,
                importantThingOne,
                importantThingTwo
            }

            $('#main_data').val(JSON.stringify(additionalData))
        }

        const initErrorMsg = () => {
            $('#empty_field_error_message').hide()
            $('#email_error_message').hide()
            $('#agreement_error_message').hide()
        }

        const validateEmail = (email) => {
            let re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(email);
        }

        const getChapterByAnswer = (answer) => {
            let result = ''
            $.each(chapters, function( index, obj ) {
                if (obj.answer === answer) {
                    result = obj.chapter
                    return false
                }
            })

            return result
        }

        const getCalculation2bValue = (answer) => {
            let result
            if (answer >= 1 && answer <= 2) {
                result = 2988
            } else if (answer >= 3 && answer <= 4) {
                result = 4188
            } else if (answer >= 5 && answer <= 6) {
                result = 4548
            } else if (answer >= 7 && answer <= 10) {
                result = 5148
            } else if (answer >= 11 && answer <= 15) {
                result = 5748
            } else if (answer >= 16 && answer <= 20) {
                result = 6348
            } else {
                result = 0
            }

            return result
        }
    </script>
{% endblock %}